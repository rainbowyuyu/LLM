<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êµ∑‰∏äÂÆâÂÖ®È¢ÑË≠¶Â§ßÊ®°Âûã</title>
    <!-- ÂºïÂÖ•MarkdownËß£ÊûêÂ∫ìÂíå‰ª£Á†ÅÈ´ò‰∫ÆÂ∫ì -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js/lib/highlight.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/github.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #e6f2ff;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(12, 116, 231, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(12, 116, 231, 0.05) 0%, transparent 20%);
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .history-sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid #d0e4f7;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid #f0f5fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            font-size: 1.2rem;
            color: #0a5cad;
            font-weight: 600;
        }

        .new-chat-btn {
            background-color: #0a5cad;
            color: white;
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .new-chat-btn:hover {
            background-color: #084a8a;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .history-item {
            padding: 0.8rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .history-item:hover {
            background-color: #f0f5fa;
        }

        .history-item.active {
            background-color: #e6f2ff;
            border-left: 3px solid #0a5cad;
        }

        .history-title {
            font-size: 0.9rem;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0.3rem;
        }

        .history-time {
            font-size: 0.75rem;
            color: #999;
        }

        .delete-history {
            position: absolute;
            right: 0.5rem;
            top: 0.5rem;
            color: #999;
            background: none;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            opacity: 0;
            transition: all 0.2s;
        }

        .history-item:hover .delete-history {
            opacity: 1;
        }

        .delete-history:hover {
            background-color: #ffeeee;
            color: #ff4d4f;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background-color: #0a5cad;
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 48, 96, 0.2);
            position: relative;
        }

        .header h1 {
            font-weight: 600;
            font-size: 1.8rem;
            letter-spacing: 0.5px;
        }

        .settings-toggle {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .settings-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-container {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .message {
            margin-bottom: 2rem;
            max-width: 80%;
            display: flex;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .bot-message {
            margin-right: auto;
        }

        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            margin: 0 10px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            flex-shrink: 0;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-content {
            padding: 1rem 1.2rem;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.6;
            position: relative;
            max-width: calc(100% - 62px);
        }

        .user-message .message-content {
            background-color: #0a5cad;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .bot-message .message-content {
            background-color: white;
            border: 1px solid #d0e4f7;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(10, 92, 173, 0.08);
        }

        /* Â™í‰ΩìÂÜÖÂÆπÊ†∑Âºè */
        .message-media {
            margin: 0.8rem 0;
            border-radius: 8px;
            overflow: hidden;
            max-width: 100%;
        }

        .message-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .message-image:hover {
            transform: scale(1.02);
        }

        .message-video {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        /* MarkdownÊ†∑Âºè */
        .message-content h1,
        .message-content h2,
        .message-content h3 {
            margin: 1rem 0 0.5rem;
            line-height: 1.3;
        }

        .message-content h1 {
            font-size: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.3rem;
        }

        .message-content h2 {
            font-size: 1.3rem;
        }

        .message-content h3 {
            font-size: 1.1rem;
        }

        .message-content p {
            margin-bottom: 0.8rem;
        }

        .message-content ul,
        .message-content ol {
            margin: 0.8rem 0;
            padding-left: 1.5rem;
        }

        .message-content li {
            margin-bottom: 0.3rem;
        }

        .message-content code {
            background-color: rgba(27, 31, 35, 0.05);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .message-content pre {
            background-color: rgba(27, 31, 35, 0.09);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 0.8rem 0;
        }

        .message-content pre code {
            background: none;
            padding: 0;
            font-size: 0.85rem;
        }

        .message-content blockquote {
            border-left: 4px solid #0a5cad;
            padding-left: 1rem;
            margin: 0.8rem 0;
            color: #666;
        }

        .message-content a {
            color: #0a5cad;
            text-decoration: none;
        }

        .message-content a:hover {
            text-decoration: underline;
        }

        .input-area {
            display: flex;
            padding: 1rem 2rem;
            background-color: white;
            border-top: 1px solid #d0e4f7;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            box-shadow: 0 -2px 10px rgba(0, 48, 96, 0.05);
        }

        .input-tools {
            display: flex;
            margin-right: 0.5rem;
            flex-direction: column;
            justify-content: flex-end;
        }

        .tool-button {
            background: none;
            border: none;
            color: #0a5cad;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            transition: all 0.2s;
        }

        .tool-button:hover {
            background-color: #f0f5fa;
        }

        .tool-button input {
            display: none;
        }

        #user-input {
            flex: 1;
            padding: 0.9rem 1.2rem;
            border: 1px solid #b9d4f1;
            border-radius: 24px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
            resize: none;
            height: 50px;
            max-height: 120px;
            overflow-y: auto;
        }

        #user-input:focus {
            border-color: #0a5cad;
            box-shadow: 0 0 0 3px rgba(10, 92, 173, 0.1);
        }

        #send-button {
            margin-left: 1rem;
            padding: 0 1.5rem;
            background-color: #0a5cad;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #send-button:hover {
            background-color: #084a8a;
            transform: translateY(-1px);
        }

        #send-button:active {
            transform: translateY(1px);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .settings {
            position: fixed;
            top: 5.5rem;
            right: 1rem;
            background-color: white;
            padding: 1.2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 48, 96, 0.15);
            z-index: 100;
            width: 300px;
            transition: all 0.3s ease;
            transform: translateX(calc(100% + 1rem));
            opacity: 0;
            pointer-events: none;
        }

        .settings.active {
            transform: translateX(0);
            opacity: 1;
            pointer-events: all;
        }

        .settings h3 {
            color: #0a5cad;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid #f0f5fa;
            padding-bottom: 0.5rem;
        }

        .settings .form-group {
            margin-bottom: 1rem;
        }

        .settings label {
            display: block;
            margin-bottom: 0.4rem;
            color: #335c80;
            font-size: 0.9rem;
        }

        .settings input {
            width: 100%;
            padding: 0.6rem 0.8rem;
            border: 1px solid #b9d4f1;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .settings input:focus {
            border-color: #0a5cad;
            outline: none;
        }

        .settings button {
            width: 100%;
            padding: 0.6rem 1rem;
            background-color: #0a5cad;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        .settings button:hover {
            background-color: #084a8a;
        }

        /* Â™í‰ΩìÈ¢ÑËßàÂÆπÂô® */
        .media-preview {
            margin-bottom: 0.8rem;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            max-width: 100%;
        }

        .media-preview img, .media-preview video {
            max-width: 100%;
            height: auto;
        }

        .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .remove-media:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* ÂÖ®Â±èÈ¢ÑËßà */
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .fullscreen-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .fullscreen-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .fullscreen-content img, .fullscreen-content video {
            max-width: 100%;
            max-height: 80vh;
        }

        .close-fullscreen {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        /* Â™í‰Ωì‰∏ä‰º†ÊåâÈíÆÂÆπÂô® */
        .media-upload-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        /* ÂêàÂπ∂ÁöÑÂ™í‰Ωì‰∏ä‰º†ÊåâÈíÆ */
        .media-upload-button {
            background: none;
            border: none;
            color: #0a5cad;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
        }

        .media-upload-button .dropdown-arrow {
            font-size: 8px;
            margin-left: 2px;
            transition: transform 0.2s;
        }

        .media-upload-button:hover {
            background-color: #f0f5fa;
        }

        .media-upload-button.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        /* ‰∏ä‰º†ÈÄâÈ°π‰∏ãÊãâËèúÂçï */
        .media-upload-options {
            position: absolute;
            bottom: 100%;
            left: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0.5rem 0;
            min-width: 120px;
            z-index: 100;
            display: none;
        }

        .media-upload-options.show {
            display: block;
        }

        /* ‰∏ä‰º†ÈÄâÈ°πÊ†∑Âºè */
        .upload-option {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            color: #333;
        }

        .upload-option:hover {
            background-color: #f0f5fa;
        }

        .upload-option .option-icon {
            margin-right: 0.5rem;
            font-size: 1rem;
        }

        /* Á¥ßÂáëÁöÑÂ™í‰ΩìÈ¢ÑËßàÂÆπÂô® */
        #media-previews-container {
            display: flex;
            gap: 0.5rem;
            padding: 0.2rem 0;
            overflow-x: auto;
            max-width: 200px;
            margin: 0;
        }

        /* Â∞èÂûãÂ™í‰ΩìÈ¢ÑËßàÊ†∑Âºè */
        .media-preview {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
            background-color: #f5f8fa;
        }

        .media-preview img,
        .media-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Âà†Èô§ÊåâÈíÆÊ†∑Âºè‰ºòÂåñ */
        .remove-media {
            position: absolute;
            top: -6px;
            right: -6px;
            background-color: #ff4d4f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* ËæìÂÖ•Ê°Ü‰ºòÂåñ - Âç†Êª°Ââ©‰ΩôÂÆΩÂ∫¶ */
        #user-input {
            flex: 1;
            padding: 0.9rem 1.2rem;
            border: 1px solid #b9d4f1;
            border-radius: 24px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
            resize: none;
            height: 50px;
            max-height: 120px;
            overflow-y: auto;
            min-width: 0; /* Ëß£ÂÜ≥flexÂ∏ÉÂ±Ä‰∏ãÂÆΩÂ∫¶Ê∫¢Âá∫ÈóÆÈ¢ò */
        }

        #user-input:focus {
            border-color: #0a5cad;
            box-shadow: 0 0 0 3px rgba(10, 92, 173, 0.1);
        }

        /* ÂèëÈÄÅÊåâÈíÆÊ†∑Âºè */
        #send-button {
            padding: 0 1.5rem;
            background-color: #0a5cad;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        #send-button:hover {
            background-color: #084a8a;
            transform: translateY(-1px);
        }

        #send-button:active {
            transform: translateY(1px);
        }

        /* ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ */
        .menu-toggle {
            display: none;
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .app-container {
                position: relative;
            }

            .history-sidebar {
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                transform: translateX(-100%);
                width: 80%;
                max-width: 280px;
            }

            .history-sidebar.active {
                transform: translateX(0);
            }

            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .chat-container {
                padding: 1rem;
            }

            .message {
                max-width: 90%;
            }

            .settings {
                width: calc(100% - 2rem);
                left: 1rem;
                right: 1rem;
                top: 5rem;
            }

            .header h1 {
                font-size: 1.5rem;
                padding-left: 2rem;
            }

            .input-area {
                padding: 0.8rem 1rem;
                gap: 0.5rem;
            }

            #media-previews-container {
                max-width: 150px;
            }

            .media-preview {
                width: 50px;
                height: 50px;
            }

            #send-button {
                padding: 0 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ÂéÜÂè≤ËÅäÂ§©ÂØºËà™Ê†è -->
        <div class="history-sidebar" id="history-sidebar">
            <div class="sidebar-header">
                <h2>ÂéÜÂè≤‰ºöËØù</h2>
                <button class="new-chat-btn" id="new-chat-btn">+</button>
            </div>
            <div class="history-list" id="history-list">
                <!-- ÂéÜÂè≤‰ºöËØùÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
            </div>
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <div class="header">
                <button class="menu-toggle" id="menu-toggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 18H21V16H3V18ZM3 13H21V11H3V13ZM3 6V8H21V6H3Z" fill="currentColor"/>
                    </svg>
                </button>
                <h1>Êµ∑‰∏äÂÆâÂÖ®È¢ÑË≠¶Â§ßÊ®°Âûã</h1>
                <button class="settings-toggle" id="settings-toggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19.14 12.94C19.18 12.64 19.2 12.33 19.2 12C19.2 11.68 19.18 11.36 19.13 11.06L21.16 9.48C21.34 9.34 21.39 9.07 21.28 8.87L19.36 5.55C19.24 5.33 18.99 5.26 18.77 5.33L16.38 6.29C15.88 5.91 15.35 5.59 14.76 5.35L14.4 2.81C14.36 2.57 14.16 2.4 13.92 2.4H10.08C9.84 2.4 9.65 2.57 9.61 2.81L9.25 5.35C8.66 5.59 8.12 5.92 7.63 6.29L5.24 5.33C5.02 5.25 4.77 5.33 4.65 5.55L2.74 8.87C2.62 9.08 2.66 9.34 2.86 9.48L4.89 11.06C4.84 11.36 4.8 11.69 4.8 12C4.8 12.31 4.82 12.64 4.87 12.94L2.84 14.52C2.66 14.66 2.61 14.93 2.72 15.13L4.64 18.45C4.76 18.67 5.01 18.74 5.23 18.67L7.62 17.71C8.12 18.09 8.65 18.41 9.24 18.65L9.6 21.19C9.65 21.43 9.84 21.6 10.08 21.6H13.92C14.16 21.6 14.35 21.43 14.39 21.19L14.75 18.65C15.34 18.41 15.88 18.09 16.37 17.71L18.76 18.67C18.98 18.75 19.23 18.67 19.35 18.45L21.27 15.13C21.39 14.91 21.34 14.66 21.14 14.52L19.14 12.94ZM12 15.6C10.02 15.6 8.4 13.98 8.4 12C8.4 10.02 10.02 8.4 12 8.4C13.98 8.4 15.6 10.02 15.6 12C15.6 13.98 13.98 15.6 12 15.6Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>

            <div class="settings" id="settings-panel">
                <h3>Á≥ªÁªüËÆæÁΩÆ</h3>
                <div class="form-group">
                    <label for="api-key">API Key</label>
                    <input type="password" id="api-key" placeholder="ËØ∑ËæìÂÖ•‰Ω†ÁöÑAPI Key">
                </div>
                <div class="form-group">
                    <label for="model-name">Ê®°ÂûãÂêçÁß∞ (ÈªòËÆ§: deepseek-r1)</label>
                    <input type="text" id="model-name" placeholder="Ê®°ÂûãÂêçÁß∞" value="deepseek-r1">
                </div>
                <button id="save-settings">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>

            <div class="chat-container" id="chat-container">
                <div class="message bot-message">
                    <div class="avatar">
                        <img src="./asset/LOGO.png" alt="Á≥ªÁªüÂ§¥ÂÉè">
                    </div>
                    <div class="message-content">
                        ‰Ω†Â•ΩÔºÅÊàëÊòØÊµ∑‰∏äÂÆâÂÖ®È¢ÑË≠¶Â§ßÊ®°Âûã„ÄÇÊ¨¢ËøéÂºÄÂßãÂí®ËØ¢Êµ∑‰∏äÂÆâÂÖ®Áõ∏ÂÖ≥ÈóÆÈ¢ò„ÄÇ‰Ω†ÂèØ‰ª•‰∏ä‰º†ÂõæÁâáÊàñËßÜÈ¢ëËé∑ÂèñÂàÜÊûê„ÄÇ
                    </div>
                </div>
            </div>

            <div class="input-area">
                <!-- ÂêàÂπ∂ÁöÑÂ™í‰Ωì‰∏ä‰º†ÊåâÈíÆ -->
                <div class="media-upload-container">
                    <button class="tool-button media-upload-button" id="media-upload-button" title="‰∏ä‰º†Â™í‰ΩìÊñá‰ª∂">
                        üìé<span class="dropdown-arrow">‚ñº</span>
                        <!-- ‰∏ãÊãâÁÆ≠Â§¥ -->
                    </button>
                    <!-- ‰∏ä‰º†ÈÄâÈ°π‰∏ãÊãâËèúÂçï -->
                    <div class="media-upload-options" id="media-upload-options">
                        <label class="upload-option">
                            <input type="file" id="image-upload" accept="image/*" hidden>
                            <span class="option-icon">üñºÔ∏è</span> ‰∏ä‰º†ÂõæÁâá
                        </label>
                        <label class="upload-option">
                            <input type="file" id="video-upload" accept="video/*" hidden>
                            <span class="option-icon">üé¨</span> ‰∏ä‰º†ËßÜÈ¢ë
                        </label>
                    </div>
                </div>

                <!-- Á¥ßÂáëÁöÑÂ™í‰ΩìÈ¢ÑËßàÂÆπÂô® -->
                <div id="media-previews-container"></div>

                <!-- ‰ºòÂåñÂÆΩÂ∫¶ÁöÑËæìÂÖ•Ê°Ü -->
                <textarea id="user-input" placeholder="ËØ∑ËæìÂÖ•ÂÖ≥‰∫éÊµ∑‰∏äÂÆâÂÖ®ÁöÑÈóÆÈ¢ò..."></textarea>

                <button id="send-button">ÂèëÈÄÅ</button>
            </div>
        </div>
    </div>

    <!-- ÂÖ®Â±èÈ¢ÑËßàÂÆπÂô® -->
    <div class="fullscreen-overlay" id="fullscreen-overlay">
        <div class="fullscreen-content" id="fullscreen-content">
            <button class="close-fullscreen" id="close-fullscreen">&times;</button>
        </div>
    </div>

    <script>
        // Â≠òÂÇ®ËÅäÂ§©‰ºöËØùÊï∞ÊçÆ
        let chatSessions = [];
        let currentSessionId = null;
        // Â≠òÂÇ®ÂΩìÂâç‰∏ä‰º†ÁöÑÂ™í‰ΩìÊñá‰ª∂
        let uploadedMedia = [];

        // ÂàùÂßãÂåñ‰ª£Á†ÅÈ´ò‰∫Æ
        document.addEventListener('DOMContentLoaded', () => {
            // ÈÖçÁΩÆmarkedËß£ÊûêÂô®
            marked.setOptions({
                highlight: function(code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        return hljs.highlight(code, { language: lang }).value;
                    }
                    return hljs.highlightAuto(code).value;
                },
                breaks: true, // ÊîØÊåÅÊç¢Ë°å
                gfm: true     // ÊîØÊåÅGitHub Flavored Markdown
            });

            // Âä†ËΩΩÊú¨Âú∞Â≠òÂÇ®ÁöÑ‰ºöËØù
            loadChatSessions();
            // Âä†ËΩΩËÆæÁΩÆ
            loadSettings();
            // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
            initEventListeners();
        });

        // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
        function initEventListeners() {
            // DOMÂÖÉÁ¥†
            const chatContainer = document.getElementById('chat-container');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const apiKeyInput = document.getElementById('api-key');
            const modelNameInput = document.getElementById('model-name');
            const saveSettingsButton = document.getElementById('save-settings');
            const settingsToggle = document.getElementById('settings-toggle');
            const settingsPanel = document.getElementById('settings-panel');
            const imageUpload = document.getElementById('image-upload');
            const videoUpload = document.getElementById('video-upload');
            const mediaUploadButton = document.getElementById('media-upload-button');
            const mediaUploadOptions = document.getElementById('media-upload-options');
            const mediaPreviewsContainer = document.getElementById('media-previews-container');
            const fullscreenOverlay = document.getElementById('fullscreen-overlay');
            const fullscreenContent = document.getElementById('fullscreen-content');
            const closeFullscreen = document.getElementById('close-fullscreen');
            const newChatBtn = document.getElementById('new-chat-btn');
            const historyList = document.getElementById('history-list');
            const menuToggle = document.getElementById('menu-toggle');
            const historySidebar = document.getElementById('history-sidebar');

            // ÂàáÊç¢ËÆæÁΩÆÈù¢ÊùøÊòæÁ§∫/ÈöêËóè
            settingsToggle.addEventListener('click', () => {
                settingsPanel.classList.toggle('active');
            });

            // ÁßªÂä®Á´ØËèúÂçïÂàáÊç¢
            menuToggle.addEventListener('click', () => {
                historySidebar.classList.toggle('active');
            });

            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠ËÆæÁΩÆÈù¢Êùø
            document.addEventListener('click', (e) => {
                if (!settingsPanel.contains(e.target) &&
                    e.target !== settingsToggle &&
                    !settingsToggle.contains(e.target)) {
                    settingsPanel.classList.remove('active');
                }
            });

            // Â™í‰Ωì‰∏ä‰º†ÊåâÈíÆ‰∫§‰∫íÈÄªËæë
            mediaUploadButton.addEventListener('click', (e) => {
                e.stopPropagation();
                mediaUploadOptions.classList.toggle('show');
                mediaUploadButton.classList.toggle('active');
            });

            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
            document.addEventListener('click', () => {
                mediaUploadOptions.classList.remove('show');
                mediaUploadButton.classList.remove('active');
            });

            // ÈòªÊ≠¢‰∏ãÊãâËèúÂçïÂÜÖÈÉ®ÁÇπÂáª‰∫ã‰ª∂ÂÜíÊ≥°
            mediaUploadOptions.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // ÂõæÁâá‰∏ä‰º†ÈÄâÊã©
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleMediaUpload(file, 'image');
                }
                imageUpload.value = ''; // ÈáçÁΩÆÈÄâÊã©
                mediaUploadOptions.classList.remove('show');
                mediaUploadButton.classList.remove('active');
            });

            // ËßÜÈ¢ë‰∏ä‰º†ÈÄâÊã©
            videoUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleMediaUpload(file, 'video');
                }
                videoUpload.value = ''; // ÈáçÁΩÆÈÄâÊã©
                mediaUploadOptions.classList.remove('show');
                mediaUploadButton.classList.remove('active');
            });

            // Â§ÑÁêÜÂõæÁâá‰∏ä‰º†
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleMediaUpload(file, 'image');
                }
                // ÈáçÁΩÆinputÂÄºÔºåÂÖÅËÆ∏ÈáçÂ§ç‰∏ä‰º†Âêå‰∏ÄÊñá‰ª∂
                imageUpload.value = '';
            });

            // Â§ÑÁêÜËßÜÈ¢ë‰∏ä‰º†
            videoUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleMediaUpload(file, 'video');
                }
                // ÈáçÁΩÆinputÂÄºÔºåÂÖÅËÆ∏ÈáçÂ§ç‰∏ä‰º†Âêå‰∏ÄÊñá‰ª∂
                videoUpload.value = '';
            });

            // ÂèëÈÄÅÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            sendButton.addEventListener('click', sendMessage);

            // ÊåâEnterÂèëÈÄÅÊ∂àÊÅØÔºåShift+EnterÊç¢Ë°å
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // ‰øùÂ≠òËÆæÁΩÆ
            saveSettingsButton.addEventListener('click', () => {
                const apiKey = apiKeyInput.value.trim();
                const modelName = modelNameInput.value.trim() || 'deepseek-r1';

                if (apiKey) {
                    localStorage.setItem('aliApiKey', apiKey);
                    localStorage.setItem('aliModelName', modelName);
                    showMessage('ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºåÂèØ‰ª•ÂºÄÂßãÂí®ËØ¢Êµ∑‰∏äÂÆâÂÖ®ÈóÆÈ¢ò‰∫ÜÔºÅ', 'bot');
                    settingsPanel.classList.remove('active'); // ‰øùÂ≠òÂêéÂÖ≥Èó≠Èù¢Êùø
                } else {
                    showMessage('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑAPI Key', 'bot');
                }
            });

            // ÂÖ≥Èó≠ÂÖ®Â±èÈ¢ÑËßà
            closeFullscreen.addEventListener('click', closeFullscreenPreview);

            // ÁÇπÂáªÂÖ®Â±èËÉåÊôØÂÖ≥Èó≠È¢ÑËßà
            fullscreenOverlay.addEventListener('click', (e) => {
                if (e.target === fullscreenOverlay) {
                    closeFullscreenPreview();
                }
            });

            // ÊåâESCÈîÆÂÖ≥Èó≠ÂÖ®Â±èÈ¢ÑËßà
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && fullscreenOverlay.classList.contains('active')) {
                    closeFullscreenPreview();
                }
            });

            // Êñ∞Âª∫ËÅäÂ§©ÊåâÈíÆ
            newChatBtn.addEventListener('click', createNewSession);
        }

        // Âä†ËΩΩËÅäÂ§©‰ºöËØù
        function loadChatSessions() {
            const savedSessions = localStorage.getItem('chatSessions');
            if (savedSessions) {
                chatSessions = JSON.parse(savedSessions);
                renderHistoryList();

                // Â¶ÇÊûúÊúâ‰ºöËØùÔºåÂä†ËΩΩÊúÄÂêé‰∏Ä‰∏™‰ºöËØù
                if (chatSessions.length > 0) {
                    switchSession(chatSessions[0].id);
                } else {
                    // Âê¶ÂàôÂàõÂª∫Êñ∞‰ºöËØù
                    createNewSession();
                }
            } else {
                // Ê≤°Êúâ‰ºöËØùÔºåÂàõÂª∫Êñ∞‰ºöËØù
                createNewSession();
            }
        }

        // ‰øùÂ≠òËÅäÂ§©‰ºöËØùÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveChatSessions() {
            localStorage.setItem('chatSessions', JSON.stringify(chatSessions));
            renderHistoryList();
        }

        // ÂàõÂª∫Êñ∞‰ºöËØù
        function createNewSession() {
            const newSession = {
                id: Date.now().toString(),
                title: 'Êñ∞‰ºöËØù',
                createdAt: new Date().toISOString(),
                messages: [
                    {
                        sender: 'bot',
                        content: '‰Ω†Â•ΩÔºÅÊàëÊòØÊµ∑‰∏äÂÆâÂÖ®È¢ÑË≠¶Â§ßÊ®°Âûã„ÄÇÊ¨¢ËøéÂºÄÂßãÂí®ËØ¢Êµ∑‰∏äÂÆâÂÖ®Áõ∏ÂÖ≥ÈóÆÈ¢ò„ÄÇ‰Ω†ÂèØ‰ª•‰∏ä‰º†ÂõæÁâáÊàñËßÜÈ¢ëËé∑ÂèñÂàÜÊûê„ÄÇ',
                        media: [],
                        timestamp: new Date().toISOString()
                    }
                ]
            };

            chatSessions.unshift(newSession);
            // ÈôêÂà∂‰ºöËØùÊï∞Èáè‰∏∫20‰∏™
            if (chatSessions.length > 20) {
                chatSessions.pop();
            }

            switchSession(newSession.id);
            saveChatSessions();

            // ÁßªÂä®Á´ØËá™Âä®ÈöêËóè‰æßËæπÊ†è
            if (window.innerWidth <= 768) {
                document.getElementById('history-sidebar').classList.remove('active');
            }
        }

        // ÂàáÊç¢‰ºöËØù
        function switchSession(sessionId) {
            currentSessionId = sessionId;
            const session = chatSessions.find(s => s.id === sessionId);

            if (session) {
                // Ê∏ÖÁ©∫ËÅäÂ§©ÂÆπÂô®
                const chatContainer = document.getElementById('chat-container');
                chatContainer.innerHTML = '';

                // Ê∏≤Êüì‰ºöËØùÊ∂àÊÅØ
                session.messages.forEach(msg => {
                    showMessage(msg.content, msg.sender, msg.media, false);
                });

                // ÊªöÂä®Âà∞Â∫ïÈÉ®
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Êõ¥Êñ∞ÂéÜÂè≤ÂàóË°®ÈÄâ‰∏≠Áä∂ÊÄÅ
                renderHistoryList();
            }

            // Ê∏ÖÁ©∫ÂΩìÂâç‰∏ä‰º†ÁöÑÂ™í‰Ωì
            clearMediaPreviews();
        }

        // Âà†Èô§‰ºöËØù
        function deleteSession(sessionId) {
            if (currentSessionId === sessionId) {
                // Â¶ÇÊûúÂà†Èô§ÂΩìÂâç‰ºöËØùÔºåÂàáÊç¢Âà∞Á¨¨‰∏Ä‰∏™‰ºöËØùÊàñÂàõÂª∫Êñ∞‰ºöËØù
                const index = chatSessions.findIndex(s => s.id === sessionId);
                chatSessions.splice(index, 1);

                if (chatSessions.length > 0) {
                    switchSession(chatSessions[0].id);
                } else {
                    createNewSession();
                }
            } else {
                // Âê¶ÂàôÁõ¥Êé•Âà†Èô§
                chatSessions = chatSessions.filter(s => s.id !== sessionId);
            }

            saveChatSessions();
        }

        // Ê∏≤ÊüìÂéÜÂè≤‰ºöËØùÂàóË°®
        function renderHistoryList() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            chatSessions.forEach(session => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${session.id === currentSessionId ? 'active' : ''}`;
                historyItem.dataset.sessionId = session.id;

                // Ê†ºÂºèÂåñÊó∂Èó¥
                const date = new Date(session.createdAt);
                const timeStr = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;

                historyItem.innerHTML = `
                    <div class="history-title">${session.title}</div>
                    <div class="history-time">${timeStr}</div>
                    <button class="delete-history" data-session-id="${session.id}">&times;</button>
                `;

                // ÁÇπÂáªÂàáÊç¢‰ºöËØù
                historyItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-history')) {
                        switchSession(session.id);
                    }
                });

                // Âà†Èô§‰ºöËØù
                const deleteBtn = historyItem.querySelector('.delete-history');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteSession(session.id);
                });

                historyList.appendChild(historyItem);
            });
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩËÆæÁΩÆ
        function loadSettings() {
            const apiKey = localStorage.getItem('aliApiKey');
            const modelName = localStorage.getItem('aliModelName');

            if (apiKey) {
                document.getElementById('api-key').value = apiKey;
            }

            if (modelName) {
                document.getElementById('model-name').value = modelName;
            }
        }

        // ÂèëÈÄÅÊ∂àÊÅØ
        // ‰øÆÊîπsendMessageÂáΩÊï∞ÔºåÊ∑ªÂä†ÂÆûÈôÖAPIËØ∑Ê±ÇÂäüËÉΩ
        function sendMessage() {
            const userInput = document.getElementById('user-input');
            const messageText = userInput.value.trim();

            // Ê£ÄÊü•ÊòØÂê¶ÊúâÊ∂àÊÅØÂÜÖÂÆπÊàñ‰∏ä‰º†ÁöÑÂ™í‰Ωì
            if (!messageText && uploadedMedia.length === 0) {
                return;
            }

            // Ëé∑ÂèñÂΩìÂâç‰ºöËØù
            const currentSession = chatSessions.find(s => s.id === currentSessionId);
            if (!currentSession) return;

            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÂà∞‰ºöËØù
            const userMessage = {
                sender: 'user',
                content: messageText,
                media: uploadedMedia.map(media => ({
                    id: media.id,
                    type: media.type,
                    url: media.url,
                    name: media.file.name
                })),
                timestamp: new Date().toISOString()
            };
            currentSession.messages.push(userMessage);

            // ÊòæÁ§∫Áî®Êà∑Ê∂àÊÅØ
            showMessage(messageText, 'user', userMessage.media);

            // Êõ¥Êñ∞‰ºöËØùÊ†áÈ¢ò
            if (currentSession.title === 'Êñ∞‰ºöËØù' && messageText) {
                currentSession.title = messageText.length > 20 ? messageText.substring(0, 20) + '...' : messageText;
            }

            // Ê∏ÖÁ©∫ËæìÂÖ•ÂíåÂ™í‰Ωì
            userInput.value = '';
            clearMediaPreviews();
            adjustInputAreaHeight();

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const loadingMessage = showMessage('', 'bot', [], true);

            // ÂáÜÂ§áÂèëÈÄÅÁªôAPIÁöÑÊï∞ÊçÆ
            const apiData = {
                message: messageText,
                media: uploadedMedia.map(media => ({
                    type: media.type,
                    name: media.file.name,
                    // ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÂèØËÉΩÈúÄË¶ÅËΩ¨Êç¢‰∏∫BlobÊàñFileÂØπË±°
                    content: media.url.split(',')[1] // ÊèêÂèñbase64ÂÜÖÂÆπ
                }))
            };

            // ÂèëÈÄÅËØ∑Ê±ÇÂà∞ÂêéÁ´ØAPIÔºà‰øÆÊ≠£ÁâàÔºâ
            fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                    // ‚ùå ‰∏çÂÜçÂú®ÂâçÁ´Ø‰º† Authorization
                },
                body: JSON.stringify({
                    model: localStorage.getItem('aliModelName') || 'deepseek-r1',
                    ...apiData
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // ÁßªÈô§Âä†ËΩΩÁä∂ÊÄÅ
                loadingMessage.remove();

                // ÊòæÁ§∫AIÂõûÂ§ç
                showMessage(data.content, 'bot');

                // ‰øùÂ≠òÂà∞‰ºöËØù
                currentSession.messages.push({
                    sender: 'bot',
                    content: data.content,
                    media: data.media || [],
                    timestamp: new Date().toISOString()
                });

                // ‰øùÂ≠ò‰ºöËØù
                saveChatSessions();
            })
            .catch(error => {
                loadingMessage.remove();
                showMessage(`Êä±Ê≠âÔºåËØ∑Ê±ÇÂ§±Ë¥•: ${error.message}`, 'bot');
                console.error('APIËØ∑Ê±ÇÈîôËØØ:', error);
            });

        }

        // ÊòæÁ§∫Ê∂àÊÅØÔºàÊîØÊåÅMarkdownËß£ÊûêÂíåÂ™í‰ΩìÊòæÁ§∫Ôºâ
        function showMessage(content, sender, media = [], isLoading = false) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;

            // ÂàõÂª∫Â§¥ÂÉè
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            const avatarImg = document.createElement('img');

            if (sender === 'user') {
                avatarImg.src = 'https://picsum.photos/id/1005/200/200'; // Áî®Êà∑Â§¥ÂÉè
                avatarImg.alt = 'Áî®Êà∑Â§¥ÂÉè';
            } else {
                avatarImg.src = './asset/LOGO.png'; // Á≥ªÁªüÂ§¥ÂÉè
                avatarImg.alt = 'Á≥ªÁªüÂ§¥ÂÉè';
            }

            avatarDiv.appendChild(avatarImg);

            // ÂàõÂª∫Ê∂àÊÅØÂÜÖÂÆπÂÆπÂô®
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            // Ê∑ªÂä†Â™í‰ΩìÂÜÖÂÆπ
            media.forEach(item => {
                const mediaContainer = document.createElement('div');
                mediaContainer.className = 'message-media';

                if (item.type === 'image') {
                    const img = document.createElement('img');
                    img.src = item.url;
                    img.className = 'message-image';
                    img.alt = 'ÂõæÁâá';
                    img.addEventListener('click', () => {
                        openFullscreenPreview(item.url, 'image');
                    });
                    mediaContainer.appendChild(img);
                } else if (item.type === 'video') {
                    const video = document.createElement('video');
                    video.src = item.url;
                    video.className = 'message-video';
                    video.controls = true;
                    video.addEventListener('click', (e) => {
                        if (e.target === video) {
                            openFullscreenPreview(item.url, 'video');
                        }
                    });
                    mediaContainer.appendChild(video);
                }

                contentDiv.appendChild(mediaContainer);
            });

            // Ê∑ªÂä†ÊñáÊú¨ÂÜÖÂÆπÊàñÂä†ËΩΩÁä∂ÊÄÅ
            if (isLoading) {
                contentDiv.innerHTML += '<div class="loading"></div>';
            } else if (content && content.trim()) {
                if (sender === 'bot') {
                    contentDiv.innerHTML += marked.parse(content);
                    // ÂØπËß£ÊûêÂêéÁöÑ‰ª£Á†ÅÂùóÂ∫îÁî®È´ò‰∫Æ
                    contentDiv.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                } else {
                    const textDiv = document.createElement('p');
                    textDiv.textContent = content;
                    contentDiv.appendChild(textDiv);
                }
            }

            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);

            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            chatContainer.scrollTop = chatContainer.scrollHeight;

            return messageDiv;
        }

        // Â§ÑÁêÜÂ™í‰Ωì‰∏ä‰º†
        function handleMediaUpload(file, type) {
            // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞è (20MB‰ª•ÂÜÖ)
            if (file.size > 20 * 1024 * 1024) {
                showMessage('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá20MB', 'bot');
                return;
            }

            // ÂàõÂª∫Êñá‰ª∂ËØªÂèñÂô®
            const reader = new FileReader();
            reader.onload = function(e) {
                // Â≠òÂÇ®Â™í‰Ωì‰ø°ÊÅØ
                const mediaId = Date.now().toString();
                uploadedMedia.push({
                    id: mediaId,
                    file: file,
                    type: type,
                    url: e.target.result
                });

                // ÂàõÂª∫È¢ÑËßà
                createMediaPreview(mediaId, type, e.target.result);

                // Ë∞ÉÊï¥ËæìÂÖ•Ê°ÜÈ´òÂ∫¶
                adjustInputAreaHeight();
            };

            if (type === 'image') {
                reader.readAsDataURL(file);
            } else {
                reader.readAsDataURL(file);
            }
        }

        // ÂàõÂª∫Â™í‰ΩìÈ¢ÑËßà
        function createMediaPreview(mediaId, type, url) {
            const mediaPreviewsContainer = document.getElementById('media-previews-container');
            const previewDiv = document.createElement('div');
            previewDiv.className = 'media-preview';
            previewDiv.dataset.mediaId = mediaId;

            if (type === 'image') {
                const img = document.createElement('img');
                img.src = url;
                img.className = 'message-image';
                img.alt = 'È¢ÑËßàÂõæ';
                previewDiv.appendChild(img);
            } else if (type === 'video') {
                const video = document.createElement('video');
                video.src = url;
                video.className = 'message-video';
                video.controls = true;
                video.preload = 'metadata';
                previewDiv.appendChild(video);
            }

            // Ê∑ªÂä†Âà†Èô§ÊåâÈíÆ
            const removeButton = document.createElement('button');
            removeButton.className = 'remove-media';
            removeButton.innerHTML = '&times;';
            removeButton.addEventListener('click', (e) => {
                e.stopPropagation();
                // ‰ªéÊï∞ÁªÑ‰∏≠ÁßªÈô§
                uploadedMedia = uploadedMedia.filter(media => media.id !== mediaId);
                // ‰ªéDOM‰∏≠ÁßªÈô§
                previewDiv.remove();
                // Ë∞ÉÊï¥ËæìÂÖ•Ê°ÜÈ´òÂ∫¶
                adjustInputAreaHeight();
            });

            previewDiv.appendChild(removeButton);

            // Ê∑ªÂä†ÁÇπÂáªÂÖ®Â±èÈ¢ÑËßà‰∫ã‰ª∂
            previewDiv.addEventListener('click', (e) => {
                if (e.target !== removeButton) {
                    openFullscreenPreview(url, type);
                }
            });

            mediaPreviewsContainer.appendChild(previewDiv);
        }

        // Ê∏ÖÁ©∫Â™í‰ΩìÈ¢ÑËßà
        function clearMediaPreviews() {
            const mediaPreviewsContainer = document.getElementById('media-previews-container');
            mediaPreviewsContainer.innerHTML = '';
            uploadedMedia = [];
        }

        // ÊâìÂºÄÂÖ®Â±èÈ¢ÑËßà
        function openFullscreenPreview(url, type) {
            const fullscreenContent = document.getElementById('fullscreen-content');
            fullscreenContent.innerHTML = '';

            // Ê∑ªÂä†ÂÖ≥Èó≠ÊåâÈíÆ
            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-fullscreen';
            closeBtn.innerHTML = '&times;';
            closeBtn.addEventListener('click', closeFullscreenPreview);
            fullscreenContent.appendChild(closeBtn);

            if (type === 'image') {
                const img = document.createElement('img');
                img.src = url;
                fullscreenContent.appendChild(img);
            } else if (type === 'video') {
                const video = document.createElement('video');
                video.src = url;
                video.controls = true;
                video.style.maxHeight = '80vh';
                fullscreenContent.appendChild(video);
            }

            document.getElementById('fullscreen-overlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // ÂÖ≥Èó≠ÂÖ®Â±èÈ¢ÑËßà
        function closeFullscreenPreview() {
            document.getElementById('fullscreen-overlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Ë∞ÉÊï¥ËæìÂÖ•Ê°ÜÈ´òÂ∫¶
        function adjustInputAreaHeight() {
            const userInput = document.getElementById('user-input');
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 120) + 'px';
        }
    </script>
</body>
</html>